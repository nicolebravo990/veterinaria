{% load static %}
<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="utf-8"/>
    <meta name="viewport" content="width=device-width,initial-scale=1"/>
    <title>Alimentos de Perro Cachorro</title>

    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
        body {
            background:#f8f9fa;
            padding-top:110px;
        }

        /* NAVBAR */
        .navbar {
            background-color:#1ed1da;
            padding:1rem 2rem;
            background-image:url('https://static.vecteezy.com/system/resources/previews/006/470/731/non_2x/modern-animal-pet-logo-template-free-vector.jpg');
            background-size:110px 100px;
            background-repeat:no-repeat;
            background-position:10px center;
            border-radius:0 0 15px 15px;
            box-shadow:0 4px 6px rgba(0,0,0,0.1);
        }

        .navbar .nav-link {
            font-weight:500;
            color:white!important;
        }

        .dropdown-menu .dropdown-item {
            color:black!important;
        }

        /* TARJETAS */
        .card {
            border-radius:15px;
            box-shadow:0 4px 10px rgba(0,0,0,0.15);
            transition:.2s;
            height:100%;
        }

        .card:hover {
            transform:scale(1.03);
        }

        .img-card {
            height:230px;
            object-fit:cover;
            border-top-left-radius:15px;
            border-top-right-radius:15px;
        }

        .navbar-search input {
            border-radius:20px;
            padding:5px 15px;
            border:none;
            outline:none;
        }

        .navbar-search button {
            border:none;
            background:transparent;
            margin-left:5px;
            color:white;
            font-size:18px;
        }

        .quantity-btn {
            background-color:#1ed1da;
            border:none;
            color:white;
            width:35px;
            height:35px;
            border-radius:50%;
        }

        /* Fix submenu Bootstrap */
        .dropdown-submenu {
            position: relative;
        }
        .dropdown-submenu .dropdown-menu {
            top: 0;
            left: 100%;
            margin-left: .1rem;
        }

        .btn-volver {
            background-color: #1ed1da;
            border: none;
            color: white;
            padding: 0.6rem 1.2rem;
            border-radius: 8px;
            font-weight: 500;
            transition: background 0.3s;
        }

        .btn-volver:hover {
            background-color: #17b7c0;
        }
    </style>
</head>
<body>

<!-- NAVBAR -->
<nav class="navbar navbar-expand-lg fixed-top">
    <div class="container-fluid">

        <a class="navbar-brand text-white ms-5" href="{% url 'vet_inicio' %}"></a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
            data-bs-target="#navbarNav">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse" id="navbarNav">

            <!-- MEN√ö -->
            <ul class="navbar-nav p-2 ms-5">
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'vet_inicio' %}">Inicio</a>
                </li>

                <!-- CATEGOR√çAS -->
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle" href="#" data-bs-toggle="dropdown">
                        Categor√≠as
                    </a>

                    <ul class="dropdown-menu">

                        <!-- PERROS -->
                        <li class="dropdown-submenu">
                            <a class="dropdown-item dropdown-toggle" href="#">üê∂ Perros</a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="{% url 'perro_adulto'%}">Alimento Perro adulto</a></li>
                                <li><a class="dropdown-item" href="{% url 'perro_cachorro'%}">Alimento Perro cachorro</a></li>
                                <li><a class="dropdown-item" href="{% url 'perro_senior'%}">Alimento Perro Senior</a></li>
                                <li><a class="dropdown-item" href="{% url 'snack_perro'%}">Snacks</a></li>
                            </ul>
                        </li>

                        <!-- GATOS -->
                        <li class="dropdown-submenu">
                            <a class="dropdown-item dropdown-toggle" href="#">üê± Gatos</a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="{% url 'gato_adulto'%}">Alimento Gato Adulto</a></li>
                                <li><a class="dropdown-item" href="{% url 'gato_cachorro'%}">Alimento Gato Cachorro</a></li>
                                <li><a class="dropdown-item" href="{% url 'snack_gato'%}">Snacks</a></li>
                            </ul>
                        </li>

                        <!-- MEDICAMENTOS -->
                        <li class="dropdown-submenu">
                            <a class="dropdown-item dropdown-toggle" href="#">üíä Medicamentos</a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="{% url 'antiparasitario'%}">Antiparasitarios</a></li>
                                <li><a class="dropdown-item" href="{% url 'shampoos'%}">Shampoo</a></li>
                                <li><a class="dropdown-item" href="{% url 'medicamentos'%}">Otros medicamentos</a></li>
                            </ul>
                        </li>

                        <!-- ACCESORIOS -->
                        <li class="dropdown-submenu">
                            <a class="dropdown-item dropdown-toggle" href="#">ü¶¥ Accesorios</a>
                            <ul class="dropdown-menu">
                                <li><a class="dropdown-item" href="{% url 'collares'%}">Collares y correas</a></li>
                                <li><a class="dropdown-item" href="{% url 'camas'%}">Camas y mantas</a></li>
                                <li><a class="dropdown-item" href="{% url 'juguetes'%}">Juguetes</a></li>
                            </ul>
                        </li>

                    </ul>
                </li>

                <li class="nav-item">
                    <a class="nav-link" href="{% url 'sobre_nosotros'%}">Sobre Nosotros</a>
                </li>
            </ul>

            <!-- BUSCADOR -->
            <form class="navbar-search d-flex ms-auto me-4">
                <input type="text" placeholder="Buscar productos...">
                <button type="submit"><i class="bi bi-search"></i></button>
            </form>

            <!-- ICONOS DERECHA -->
            <ul class="navbar-nav d-flex align-items-center">

                <li class="nav-item me-3">
                    <a class="nav-link" href="{% url 'ver_carrito' %}">
                        <i class="bi bi-cart3"></i> Carrito
                    </a>
                </li>

                {% if user.is_authenticated %}
                <li class="nav-item me-3">
                    <a class="nav-link btn btn-outline-light" href="{% url 'agendar_cita' %}">
                        Agendar Cita
                    </a>
                </li>

                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle text-white" href="#" data-bs-toggle="dropdown">
                        <i class="bi bi-person-circle"></i> {{ user.username }}
                    </a>

                    <ul class="dropdown-menu dropdown-menu-end">
                        <li><a class="dropdown-item" href="#">Mi Perfil</a></li>
                        <li><a class="dropdown-item" href="{% url 'logout' %}">Cerrar Sesi√≥n</a></li>
                    </ul>
                </li>

                {% else %}
                <li class="nav-item">
                    <a class="nav-link" href="{% url 'login'%}">
                        <i class="bi bi-person-circle"></i> Iniciar Sesi√≥n
                    </a>
                </li>
                {% endif %}
            </ul>

        </div>
    </div>
</nav>

<!-- CONTENIDO -->
<div class="container mt-5">
    <h1 class="text-center mb-4">Alimentos para Perros Cachorro</h1>

    <div class="row">
        {% for producto in pcproductos %}
        <div class="col-md-4 mb-4">
            <div class="card">

                {% if producto.imagen %}
                <img src="{{ producto.imagen.url }}" class="img-card w-100">
                {% else %}
                <div style="height:230px;background:#eee;display:flex;align-items:center;justify-content:center;">
                    Sin imagen
                </div>
                {% endif %}

                <div class="card-body text-center">
                    <h5 class="card-title">{{ producto.nombre }}</h5>
                    <p class="text-muted">{{ producto.descripcion|truncatechars:60 }}</p>
                    <p class="text-success fw-bold">${{ producto.precio }}</p>

                    <!-- BOT√ìN MODAL -->
                    <button
                        type="button"
                        class="btn btn-primary"
                        data-bs-toggle="modal"
                        data-bs-target="#modalDetalle"
                        data-id="{{ producto.id }}"
                        data-nombre="{{ producto.nombre|escapejs }}"
                        data-descripcion="{{ producto.descripcion|escapejs }}"
                        data-precio="{{ producto.precio }}"
                        data-imagen="{% if producto.imagen %}{{ producto.imagen.url }}{% endif %}"
                    >
                        Ver Detalle
                    </button>
                </div>

            </div>
        </div>
        {% empty %}
        <p class="text-center">No hay productos registrados a√∫n.</p>
        {% endfor %}
    </div>

    <div class="d-flex justify-content-start mt-4">
            <a href="{% url 'vet_inicio' %}" class="btn-volver">
                <i class="bi bi-arrow-left"></i> Volver
            </a>
        </div>
</div>

<!-- MODAL -->
<div class="modal fade" id="modalDetalle" tabindex="-1">
    <div class="modal-dialog modal-lg modal-dialog-centered">
        <div class="modal-content">

            <div class="modal-header bg-info text-white">
                <h5 id="modalTitulo" class="modal-title"></h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>

            <form method="post" id="formAgregar">
                {% csrf_token %}

                <div class="modal-body text-center">
                    <img id="modalImagen" class="img-fluid rounded mb-3" style="max-height:260px;">
                    <p id="modalDescripcion"></p>
                    <h4 id="modalPrecio" class="text-success"></h4>

                    <div class="d-flex justify-content-center align-items-center mt-3">
                        <button type="button" class="quantity-btn" id="btnMenos">‚àí</button>
                        <input id="inputCantidad" name="cantidad" type="number" value="1" min="1" class="mx-3 text-center" style="width:70px;">
                        <button type="button" class="quantity-btn" id="btnMas">+</button>
                    </div>
                </div>

                <div class="modal-footer">
                    <button type="button" class="btn btn-warning" data-bs-dismiss="modal">Cerrar</button>
                    <button type="submit" class="btn btn-success text-white">Agregar al Carrito</button>
                </div>

            </form>

        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    const modal = document.getElementById("modalDetalle");

    modal.addEventListener("show.bs.modal", function (e) {
        const btn = e.relatedTarget;

        const nombre = btn.dataset.nombre || "";
        const descripcion = btn.dataset.descripcion || "";
        const precio = btn.dataset.precio || "";
        const imagen = btn.dataset.imagen || "";
        const id = btn.dataset.id;

        document.getElementById("modalTitulo").textContent = nombre;
        document.getElementById("modalDescripcion").textContent = descripcion;
        document.getElementById("modalPrecio").textContent = "$" + precio;

        const img = document.getElementById("modalImagen");
        if (imagen) {
            img.src = imagen;
            img.alt = nombre;
        } else {
            img.removeAttribute("src");
            img.alt = "";
        }

        const baseUrl = "{% url 'agregar_carrito' 'pc' 0 %}";
        document.getElementById("formAgregar").action = baseUrl.replace('/0/', '/' + id + '/');
    });

    document.getElementById("btnMas").onclick = () => {
        const input = document.getElementById("inputCantidad");
        input.value = parseInt(input.value) + 1;
    };

    document.getElementById("btnMenos").onclick = () => {
        const input = document.getElementById("inputCantidad");
        if (parseInt(input.value) > 1) {
            input.value = parseInt(input.value) - 1;
        }
    };
</script>

</body>
</html>
